<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Farming Game Deluxe</title>
<style>
:root{
  --accent:#00ff7f;
  --bg1:#0f1112;
  --bg2:#121212;
  --card:#161616;
  --muted:#bfc9bd;
  --glass: rgba(255,255,255,0.03);
  --radius:14px;
  --coin-color: #ffd700;
}
*{box-sizing:border-box;}
html,body{height:100%; margin:0; font-family: 'Trebuchet MS', system-ui, sans-serif;}
body{
  background: url('BALTI.JPG') center/cover no-repeat, var(--bg1);
  color:#e9fff0;
  display:flex; justify-content:center; align-items:flex-start; padding:20px;
}
.container{
  width:980px; max-width:95vw;
  display:grid; grid-template-columns:1fr 320px; gap:20px;
}
header{grid-column:1/-1; text-align:center;}
h1{margin:0 0 10px 0; font-size:1.9rem; color:var(--accent); text-shadow:0 0 12px rgba(0,255,127,0.12);}
.sub{color:var(--muted); margin-bottom:12px;}
.panel{
  background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
  padding:14px; border-radius:var(--radius); border:1px solid rgba(0,255,127,0.08);
  box-shadow:0 6px 30px rgba(0,0,0,0.6), inset 0 0 30px rgba(0,255,127,0.02);
}
#canvasWrap{display:flex;flex-direction:column;gap:10px;align-items:center;}
canvas{border-radius:12px; background:linear-gradient(180deg,#1b1b1b,#0d0d0d); box-shadow:0 0 30px rgba(0,255,127,0.06); image-rendering: pixelated;}
.controls{display:flex; gap:10px; flex-wrap:wrap;}
.btn{cursor:pointer; border:none; padding:10px 16px; border-radius:12px; background:linear-gradient(#00ff7f,#008a4a); color:#002; font-weight:700; box-shadow:0 6px 20px rgba(0,255,127,0.08); transition:transform .12s;}
.btn:active{transform:translateY(2px);}
.btn:disabled{opacity:0.5; cursor:not-allowed; background:gray;}
.statBox{flex:1; padding:10px; background:var(--card); border-radius:10px; text-align:left; margin-bottom:6px;}
.statTitle{font-size:0.85rem; color:var(--muted);}
.statValue{font-weight:700; font-size:1.05rem;}
.xpBar{height:12px; background:rgba(255,255,255,0.04); border-radius:999px; overflow:hidden;}
.xpFill{height:100%; width:0%; background:linear-gradient(90deg,var(--accent), #8affb8); transition:width 300ms ease;}
.toast{position:fixed; left:50%; transform:translateX(-50%); bottom:28px; background:#09110a; padding:10px 16px; border-radius:999px; border:1px solid rgba(0,255,127,0.08); box-shadow:0 8px 30px rgba(0,0,0,0.6); display:none;}
.backLink{display:inline-block; margin-top:12px; color:var(--muted); text-decoration:none;}
#shopPanel .shopItem{display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; padding:8px; background:var(--card); border-radius:10px;}
#shopPanel .shopItem button{padding:6px 12px; font-size:0.9rem;}
#achievements ul{list-style:none; padding:0; color:var(--muted);}
#achievements li{margin-bottom:6px; display:flex; align-items:center; gap:6px;}
#achievements li.unlocked{color:var(--accent);}
.confetti-piece{position:absolute;width:6px;height:6px;background:gold;pointer-events:none;}
@media (max-width:900px){.container{grid-template-columns:1fr;} canvas{width:100%; height:60vh}}
</style>
</head>
<body>
<div class="container">
<header>
  <h1>üåø Mini Farming Game Deluxe</h1>
  <div class="sub">Plant seeds, watch them grow, and harvest for XP and coins!</div>
</header>

<main class="panel" id="canvasWrap">
  <canvas id="farmCanvas" width="560" height="560"></canvas>
  <div class="controls">
    <button class="btn" id="plantBtn">üå± Plant Random Seed</button>
    <button class="btn" id="harvestBtn">üåæ Harvest Ready Plants</button>
    <button class="btn" id="fillBtn">üîÅ Fill Empty Cells</button>
    <button class="btn" id="newStartBtn">üîÑ New Start</button>
    <a class="backLink" href="seite3.html">‚óÄ Back To Home</a>
  </div>
  <div id="infoRow" style="display:flex;gap:10px;margin-top:6px;">
    <div class="statBox"><div class="statTitle">Level</div><div class="statValue" id="level">1</div></div>
    <div class="statBox"><div class="statTitle">XP</div><div class="statValue" id="xp">0</div><div class="xpBar"><div id="xpFill" class="xpFill"></div></div></div>
    <div class="statBox"><div class="statTitle">Harvested</div><div class="statValue" id="harvested">0</div></div>
    <div class="statBox"><div class="statTitle">Coins</div><div class="statValue" id="coins">0</div></div>
  </div>
</main>

<aside class="panel" id="side">
  <div id="stats"><strong>üìù Strain Log</strong><div id="strainLog"></div></div>
  <div id="shopPanel" class="panel"><strong>üè™ Shop</strong><div id="shopItems"></div></div>
  <div id="achievements" class="panel"><strong>üèÜ Achievements</strong><ul id="achievementList"></ul></div>
</aside>
<div class="toast" id="toast"></div>
<audio id="plantSound" src="plant.mp3" preload="auto"></audio>
<audio id="harvestSound" src="harvest.mp3" preload="auto"></audio>
<audio id="levelUpSound" src="levelup.mp3" preload="auto"></audio>

<script>
// ---------------- Config & State
const GRID_SIZE = 5;
const canvas = document.getElementById('farmCanvas');
const ctx = canvas.getContext('2d');
const farm = Array.from({length: GRID_SIZE}, ()=>Array(GRID_SIZE).fill(null));
let xp=0, level=1, harvested=0, coins=100;
let growthMultiplier=1, xpMultiplier=1, coinMultiplier=1, autoPlantUnlocked=false;
let lastAutoPlant=0;

// ---------------- Strains, Upgrades, Achievements
const strains=[{name:"Sticky Buns",color:"#8EE28E",growRate:6,xp:12,coins:5,unlocked:true},{name:"Pink Berry Pop",color:"#E6F39B",growRate:8,xp:9,coins:4,unlocked:true},{name:"Boom Boom Berry",color:"#6FD08A",growRate:4.5,xp:15,coins:7,unlocked:true},{name:"White Rhino",color:"#DFF7D6",growRate:7,xp:10,coins:5,unlocked:true},{name:"Golden Kush",color:"#FFD700",growRate:5,xp:20,coins:10,unlocked:false,unlockLevel:3},{name:"Purple Haze",color:"#A020F0",growRate:9,xp:8,coins:6,unlocked:false,unlockLevel:5}];
const upgrades=[{id:"growthBoost",name:"Growth Boost",desc:"+20% Grow Rate",cost:30,level:0,maxLevel:3,effect:()=>growthMultiplier+=0.2},{id:"xpBoost",name:"XP Boost",desc:"+10% XP per Harvest",cost:50,level:0,maxLevel:3,effect:()=>xpMultiplier+=0.1},{id:"coinBoost",name:"Coin Boost",desc:"+15% Coins per Harvest",cost:40,level:0,maxLevel:3,effect:()=>coinMultiplier+=0.15},{id:"autoPlant",name:"Auto Planter",desc:"Automatically plants empty cells",cost:80,level:0,maxLevel:1,effect:()=>autoPlantUnlocked=true}];
const achievements=[{id:"firstHarvest",name:"First Harvest",desc:"Harvest your first plant",unlocked:false,condition:()=>harvested>=1},{id:"level5",name:"Level 5 reached",desc:"Reach level 5",unlocked:false,condition:()=>level>=5},{id:"harvest100",name:"Harvest 100 Plants",desc:"Harvest 100 plants",unlocked:false,condition:()=>harvested>=100},{id:"allUpgrades",name:"Master Upgrader",desc:"Buy all upgrades max level",unlocked:false,condition:()=>upgrades.every(u=>u.level>=u.maxLevel)}];

// ---------------- Plant & Particle
class Plant{
  constructor(strain){this.strain=strain;this.growth=0;this.sway=Math.random()*Math.PI*2;}
  grow(dt){if(this.growth<100)this.growth=Math.min(100,this.growth+this.strain.growRate*growthMultiplier*(dt/1000));}
  isReady(){return this.growth>=100;}
}

// ---------------- Helpers
function addLog(msg){const t=new Date().toLocaleTimeString();document.getElementById('strainLog').innerHTML=`<div style="margin-bottom:6px"><small style='color:var(--muted)'>[${t}]</small> ${msg}</div>`+document.getElementById('strainLog').innerHTML;}
function updateStats(){document.getElementById('xp').textContent=xp;document.getElementById('level').textContent=level;document.getElementById('harvested').textContent=harvested;document.getElementById('coins').textContent=coins;const pct=Math.min(100,Math.round((xp/xpThreshold(level))*100));document.getElementById('xpFill').style.width=pct+'%';renderShop();renderAchievements();}
function xpThreshold(l){return 40+l*20;}
function showToast(msg,ms=1500){const t=document.getElementById('toast');t.textContent=msg;t.style.display='block';clearTimeout(t._timer);t._timer=setTimeout(()=>{t.style.display='none'},ms);}
function playSound(id){const a=document.getElementById(id);if(a){a.currentTime=0;a.play().catch(()=>{});}}

// ---------------- Canvas Draw
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const cell=canvas.width/GRID_SIZE;
  for(let r=0;r<GRID_SIZE;r++){
    for(let c=0;c<GRID_SIZE;c++){
      const x=c*cell,y=r*cell;
      ctx.fillStyle='rgba(10,10,10,0.6)';
      roundRect(ctx,x+6,y+6,cell-12,cell-12,8);ctx.fill();
      ctx.strokeStyle='rgba(0,255,127,0.06)';ctx.lineWidth=1;
      roundRect(ctx,x+6,y+6,cell-12,cell-12,8);ctx.stroke();
      const p=farm[r][c];if(p){drawPlant(ctx,p,x+cell/2,y+cell/2,cell);}
    }
  }
}
function drawPlant(ctx,plant,cx,cy,cell){
  const size=(plant.growth/100)*cell*0.4;
  ctx.save();
  ctx.translate(cx,cy);
  ctx.rotate(Math.sin(performance.now()/500+plant.sway)*0.07);
  ctx.fillStyle=plant.strain.color;
  ctx.beginPath();
  ctx.arc(0,0,size,0,Math.PI*2);
  ctx.fill();
  ctx.restore();
}
function roundRect(ctx,x,y,w,h,r){ctx.beginPath();ctx.moveTo(x+r,y);ctx.lineTo(x+w-r,y);ctx.quadraticCurveTo(x+w,y,x+w,y+r);ctx.lineTo(x+w,y+h-r);ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);ctx.lineTo(x+r,y+h);ctx.quadraticCurveTo(x,y+h,x,y+h-r);ctx.lineTo(x,y+r);ctx.quadraticCurveTo(x,y,x+r,y);ctx.closePath();}

// ---------------- Game Loop
let lastFrame=performance.now();
function loop(now){
  const dt=now-lastFrame;lastFrame=now;
  for(let r=0;r<GRID_SIZE;r++)for(let c=0;c<GRID_SIZE;c++){const p=farm[r][c];if(p)p.grow(dt);}
  if(autoPlantUnlocked && now-lastAutoPlant>3000){autoPlant();lastAutoPlant=now;}
  draw();checkLevelUp();updateStats();checkAchievements();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

// ---------------- Game Actions
function plantRandom(){const empty=[];for(let r=0;r<GRID_SIZE;r++)for(let c=0;c<GRID_SIZE;c++)if(!farm[r][c])empty.push({r,c});if(empty.length==0)return showToast("No empty cell!");const cell=empty[Math.floor(Math.random()*empty.length)];const avail=strains.filter(s=>s.unlocked);const strain=avail[Math.floor(Math.random()*avail.length)];farm[cell.r][cell.c]=new Plant(strain);playSound('plantSound');addLog(`Planted ${strain.name}`);}
function harvestReady(){let count=0;for(let r=0;r<GRID_SIZE;r++)for(let c=0;c<GRID_SIZE;c++){const p=farm[r][c];if(p && p.isReady()){xp+=Math.floor(p.strain.xp*xpMultiplier);coins+=Math.floor(p.strain.coins*coinMultiplier);harvested++;count++;farm[r][c]=null;}}if(count>0){showToast(`Harvested ${count} plants!`);playSound('harvestSound');addLog(`Harvested ${count} plants`);}}
function fillEmpty(){for(let r=0;r<GRID_SIZE;r++)for(let c=0;c<GRID_SIZE;c++){if(!farm[r][c])plantRandom();}}
function newStart(){if(confirm("Start over?")){for(let r=0;r<GRID_SIZE;r++)for(let c=0;c<GRID_SIZE;c++)farm[r][c]=null;xp=0;level=1;harvested=0;coins=100;growthMultiplier=1;xpMultiplier=1;coinMultiplier=1;autoPlantUnlocked=false;updateStats();showToast("Game Reset!");addLog("New game started.");}}
function autoPlant(){for(let r=0;r<GRID_SIZE;r++)for(let c=0;c<GRID_SIZE;c++){if(!farm[r][c])plantRandom();}}
function checkLevelUp(){const threshold=xpThreshold(level);if(xp>=threshold){level++;xp-=threshold;playSound('levelUpSound');showToast(`Level Up! Now ${level}`);updateBackground();addLog(`Level Up to ${level}`);unlockStrains();}}
function updateBackground(){const backgrounds=["#0f1112","#10120d","#111310","#121411","#131512","#141613"];document.body.style.backgroundColor=backgrounds[Math.min(level,backgrounds.length-1)];}
function unlockStrains(){strains.forEach(s=>{if(!s.unlocked && s.unlockLevel && level>=s.unlockLevel){s.unlocked=true;showToast(`New Strain Unlocked: ${s.name}`);addLog(`Unlocked strain: ${s.name}`);}});}

// ---------------- Shop & Achievements
function renderShop(){const el=document.getElementById('shopItems');el.innerHTML='';upgrades.forEach(u=>{const btn=document.createElement('button');btn.textContent=u.level<u.maxLevel?`Buy (${u.cost} coins)`:`Max`;btn.disabled=u.level>=u.maxLevel||coins<u.cost;btn.onclick=()=>{if(coins>=u.cost && u.level<u.maxLevel){coins-=u.cost;u.level++;u.effect();showToast(`Bought ${u.name}`);updateStats();}};const div=document.createElement('div');div.className='shopItem';div.innerHTML=`<span>${u.name} Lv${u.level}</span>`;div.appendChild(btn);el.appendChild(div);});}
function renderAchievements(){const el=document.getElementById('achievementList');el.innerHTML='';achievements.forEach(a=>{const unlocked=a.unlocked?'unlocked':'';const li=document.createElement('li');li.className=unlocked;li.textContent=a.name;el.appendChild(li);});}
function checkAchievements(){achievements.forEach(a=>{if(!a.unlocked && a.condition()){a.unlocked=true;showToast(`Achievement: ${a.name}!`);addLog(`Achievement unlocked: ${a.name}`);confettiBurst(20);}});}

// ---------------- Confetti
function confettiBurst(count){for(let i=0;i<count;i++){const div=document.createElement('div');div.className='confetti-piece';document.body.appendChild(div);div.style.left=Math.random()*window.innerWidth+'px';div.style.top='0px';div.style.backgroundColor=['#ff0','#f0f','#0ff','#0f0','#f80'][Math.floor(Math.random()*5)];const speed=2+Math.random()*3;const angle=Math.random()*Math.PI*2;let y=0;function fall(){y+=speed;div.style.top=y+'px';div.style.transform=`rotate(${angle*y}rad)`;if(y<window.innerHeight){requestAnimationFrame(fall);}else{div.remove();}}fall();}}

// ---------------- Event Listeners
document.getElementById('plantBtn').onclick=plantRandom;
document.getElementById('harvestBtn').onclick=harvestReady;
document.getElementById('fillBtn').onclick=fillEmpty;
document.getElementById('newStartBtn').onclick=newStart;

updateStats();
